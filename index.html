<!doctype html>
<html lang="uk" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WPlace — конвертер у палітру</title>
  <!-- стилі окремим файлом (не дублюю CSS) -->
  <link rel="stylesheet" href="styles.css" />
  <meta name="description" content="Конвертер зображень у палітру WPlace з різними алгоритмами дизерингу, попередньою обробкою та експортом PNG." />
</head>
<body>
  <header class="topbar">
    <div class="container topbar__inner">
      <h1>WPlace — конвертер у палітру</h1>
      <div class="topbar__right">
        <label class="theme-toggle" title="Перемкнути світлу/темну тему">
          <input id="themeToggle" type="checkbox" />
          <span class="slider"></span>
          <span class="label">Темна тема</span>
        </label>
        <div class="muted small">Дизеринг: Floyd–Steinberg, Atkinson, Ordered, Sierra, JJN, Stucki, Burkes, Random, Blue Noise тощо</div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- Ліва панель: вхід -->
      <section class="card">
        <h2>1) Завантажте зображення</h2>

        <div id="drop" class="drop" aria-label="Зона перетягування файлів">
          <p>Перетягніть файл сюди або натисніть, щоб обрати</p>
          <input id="file" type="file" accept="image/*" hidden />
          <div class="hint">Також можна вставити URL:</div>
          <input id="url" type="text" placeholder="https://..." />
        </div>

        <div class="mt-16">
          <div class="label">Попередній перегляд джерела</div>
          <div class="checker">
            <canvas id="src" class="preview"></canvas>
          </div>
        </div>
      </section>

      <!-- Права панель: результат -->
      <section class="card">
        <h2>Результат</h2>
        <div class="checker" title="Прев’ю без згладжування (pixelated)">
          <canvas id="out" class="preview"></canvas>
        </div>
        <p class="hint mt-8">
          PNG зберігається у натуральному розмірі. <b>Прозорі пікселі</b> (альфа 0) зберігаються прозорими,
          <b>напівпрозорі</b> стають повністю непрозорими. Всі кольори квантизуються лише до палітри WPlace.
        </p>
      </section>
    </div>

    <div class="grid mt-24">
      <!-- Налаштування -->
      <section class="card">
        <h2>2) Налаштування</h2>
        <div class="form">
          <label>Колірна метрика
            <select id="metric">
              <option>Lab</option>
              <option>RGB</option>
            </select>
          </label>

          <label>Дизеринг
            <select id="dither">
              <!-- базові -->
              <option>Floyd–Steinberg</option>
              <option>Atkinson</option>
              <option>Ordered (8x8)</option>
              <!-- додаткові ordered/шум -->
              <option>Ordered (4x4)</option>
              <option>Random</option>
              <option>Blue Noise</option>
              <!-- ядра дифузії -->
              <option>Burkes</option>
              <option>Stucki</option>
              <option>Jarvis–Judice–Ninke</option>
              <option>Sierra Lite</option>
              <option>Sierra 2-4A</option>
              <option>Sierra 3</option>
              <option>Two-Row Sierra</option>
              <!-- специфічні/візерункові -->
              <option>Riemersma</option>
              <option>Halftone (dots)</option>
              <option>Halftone (lines)</option>
              <option>Pattern 2x2</option>
              <option>Clustered Dot (8x8)</option>
              <option>Gradient Threshold Map</option>
              <!-- вимкнути -->
              <option>None</option>
            </select>
          </label>

          <div id="orderedWrap" class="hidden">
            <label>Сила патерну/шуму/ordered: <span id="orderedVal">0.75</span>
              <input id="ordered" type="range" min="0" max="3" step="0.01" value="0.75" />
            </label>
          </div>

          <label>Ширина результату: <span id="wVal">128</span> px
            <input id="outW" type="range" min="16" max="1024" value="128" />
          </label>

          <label>Масштаб попереднього перегляду (піксель-арт): x<span id="scaleVal">4</span>
            <input id="scale" type="range" min="1" max="32" value="4" />
          </label>

          <!-- «пом’якшення» перед дизерингом (без Gaussian blur, як просив) -->
          <label>Насиченість (перед дизерингом): <span id="satVal">1.00</span>
            <input id="saturation" type="range" min="0" max="2" step="0.01" value="1" />
          </label>

          <label>Контраст (перед дизерингом): <span id="ctrVal">1.00</span>
            <input id="contrast" type="range" min="0.5" max="1.5" step="0.01" value="1" />
          </label>
        </div>

        <div class="actions">
          <button id="convert" class="btn">Конвертувати</button>
          <button id="save" class="btn secondary">Завантажити PNG</button>
        </div>
      </section>

      <!-- Палітра -->
      <section class="card">
        <h2>3) Палітра WPlace (<span id="pcount"></span> кольорів)</h2>
        <div id="palette" class="palette" aria-label="Палітра wplace"></div>
      </section>
    </div>

    <section class="card mt-24">
      <h2>Підказки</h2>
      <ul class="tips">
        <li>Метрика <b>Lab</b> зазвичай дає природніші відповідності кольорів, ніж RGB.</li>
        <li>Спробуй <b>JJN/Stucki/Sierra</b> для плавніших градієнтів; <b>Ordered/Clustered</b> — для чистих заливок; <b>Halftone</b> — для поліграфічного стилю.</li>
        <li>Зменшуйте ширину, якщо потрібно вкластися у ліміт пікселів батлу.</li>
        <li>Напівпрозорі пікселі робимо непрозорими; повністю прозорі зберігаємо як прозорі.</li>
      </ul>
    </section>
  </main>

  <footer class="container footer">Зроблено для піксель-батлу WPlace.</footer>

  <!-- скрипти окремим файлом (не дублюю JS) -->
  <script src="app.js"></script>
</body>
</html>
